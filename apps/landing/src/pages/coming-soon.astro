---
import Layout from '../layouts/Layout.astro';
import Card from '../components/ui/Card.astro';
import Button from '../components/ui/Button.astro';
import Input from '../components/ui/Input.astro';
import { useTranslations } from '../i18n';

const t = useTranslations('en');
---

<Layout
  title="Coming Soon - IQON-IA"
  description="IQON-IA is launching soon. Subscribe to our newsletter to be the first to know."
  canonicalPath="/coming-soon"
>
  <section class="min-h-[80vh] flex items-center justify-center py-20 sm:py-28">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <!-- Badge -->
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 text-primary text-sm font-medium mb-8">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
        </span>
        {t('comingSoon.title')}
      </div>

      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-foreground mb-6">
        {t('comingSoon.title')}
      </h1>
      <p class="text-lg sm:text-xl text-muted-foreground mb-12 max-w-xl mx-auto">
        {t('comingSoon.subtitle')}
      </p>

      <!-- Newsletter Form -->
      <Card padding="lg" class="max-w-md mx-auto">
        <h2 class="text-xl font-semibold text-foreground mb-2">
          {t('comingSoon.newsletter.title')}
        </h2>
        <p class="text-sm text-muted-foreground mb-6">
          {t('comingSoon.newsletter.subtitle')}
        </p>

        <form id="newsletter-form" class="space-y-4">
          <Input
            type="email"
            name="email"
            placeholder={t('comingSoon.newsletter.email')}
            required
          />
          <Button type="submit" fullWidth>
            {t('comingSoon.newsletter.submit')}
          </Button>
        </form>

        <!-- Success/Error messages (hidden by default) -->
        <div id="newsletter-success" class="hidden mt-4 p-3 rounded-lg bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800">
          <p class="text-sm text-green-700 dark:text-green-300 flex items-center gap-2">
            <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            {t('comingSoon.newsletter.success')}
          </p>
        </div>
        <div id="newsletter-error" class="hidden mt-4 p-3 rounded-lg bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800">
          <p class="text-sm text-red-700 dark:text-red-300">
            {t('comingSoon.newsletter.error')}
          </p>
        </div>
      </Card>

      <!-- Back to home -->
      <a href="/" class="inline-flex items-center gap-2 mt-8 text-sm text-muted-foreground hover:text-foreground transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
        </svg>
        {t('comingSoon.backHome')}
      </a>
    </div>
  </section>
</Layout>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const successEl = document.getElementById('newsletter-success')!;
  const errorEl = document.getElementById('newsletter-error')!;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    successEl.classList.add('hidden');
    errorEl.classList.add('hidden');

    const formData = new FormData(form);
    const email = formData.get('email') as string;

    const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    const originalText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = '...';

    try {
      const response = await fetch('/api/v1/newsletter/subscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
      });

      if (response.ok) {
        successEl.classList.remove('hidden');
        form.reset();
      } else {
        errorEl.classList.remove('hidden');
      }
    } catch {
      errorEl.classList.remove('hidden');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  });
</script>
