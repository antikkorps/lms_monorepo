---
import Card from '../ui/Card.astro';
import Button from '../ui/Button.astro';
import Badge from '../ui/Badge.astro';

interface PricingPlan {
  name: string;
  price: string;
  period: string;
  description: string;
  features: string[];
  cta: string;
  ctaHref: string;
  popular?: boolean;
  badge?: string;
}

interface Props {
  title: string;
  subtitle: string;
  plans: PricingPlan[];
  billingToggle?: {
    monthly: string;
    annual: string;
    annualDiscount?: string;
  };
}

const {
  title,
  subtitle,
  plans,
  billingToggle,
} = Astro.props;
---

<section id="pricing" class="py-20 sm:py-28">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center max-w-3xl mx-auto mb-12">
      <h2 class="text-3xl sm:text-4xl font-bold text-foreground">
        {title}
      </h2>
      <p class="mt-4 text-lg text-muted-foreground">
        {subtitle}
      </p>

      {billingToggle && (
        <div class="mt-8 inline-flex items-center gap-4 p-1 bg-muted rounded-lg">
          <button
            id="monthly-toggle"
            class="px-4 py-2 text-sm font-medium rounded-md transition-colors bg-background text-foreground shadow-sm"
          >
            {billingToggle.monthly}
          </button>
          <button
            id="annual-toggle"
            class="px-4 py-2 text-sm font-medium rounded-md transition-colors text-muted-foreground hover:text-foreground"
          >
            {billingToggle.annual}
            {billingToggle.annualDiscount && (
              <Badge variant="default" class="ml-2 bg-green-500">{billingToggle.annualDiscount}</Badge>
            )}
          </button>
        </div>
      )}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8 items-start pt-4">
      {plans.map((plan, index) => (
        <div class={`relative ${plan.popular ? 'order-first md:order-none' : ''}`}>
          {plan.badge && (
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 z-10">
              <Badge>{plan.badge}</Badge>
            </div>
          )}
          <Card
            padding="lg"
            class={`h-full flex flex-col ${plan.popular ? 'border-primary ring-2 ring-primary/20 md:scale-105 md:shadow-xl' : ''} animate-slide-up stagger-${index + 1}`}
          >
            <div class="text-center mb-6">
              <h3 class="text-xl font-semibold text-foreground">{plan.name}</h3>
              <p class="text-sm text-muted-foreground mt-1">{plan.description}</p>
              <div class="mt-4">
                <span class="text-4xl font-bold text-foreground">{plan.price}</span>
                <span class="text-muted-foreground">{plan.period}</span>
              </div>
            </div>

            <ul class="space-y-3 flex-1 mb-8">
              {plan.features.map((feature) => (
                <li class="flex items-start gap-3">
                  <svg class="w-5 h-5 text-green-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                  <span class="text-sm text-muted-foreground">{feature}</span>
                </li>
              ))}
            </ul>

            <Button
              href={plan.ctaHref}
              variant={plan.popular ? 'default' : 'outline'}
              fullWidth
            >
              {plan.cta}
            </Button>
          </Card>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  const monthlyToggle = document.getElementById('monthly-toggle');
  const annualToggle = document.getElementById('annual-toggle');

  if (monthlyToggle && annualToggle) {
    monthlyToggle.addEventListener('click', () => {
      monthlyToggle.classList.add('bg-background', 'text-foreground', 'shadow-sm');
      monthlyToggle.classList.remove('text-muted-foreground');
      annualToggle.classList.remove('bg-background', 'text-foreground', 'shadow-sm');
      annualToggle.classList.add('text-muted-foreground');
    });

    annualToggle.addEventListener('click', () => {
      annualToggle.classList.add('bg-background', 'text-foreground', 'shadow-sm');
      annualToggle.classList.remove('text-muted-foreground');
      monthlyToggle.classList.remove('bg-background', 'text-foreground', 'shadow-sm');
      monthlyToggle.classList.add('text-muted-foreground');
    });
  }
</script>
