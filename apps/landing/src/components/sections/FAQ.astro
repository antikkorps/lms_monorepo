---
interface FAQItem {
  question: string;
  answer: string;
}

interface FAQCategory {
  name: string;
  items: FAQItem[];
}

interface Props {
  title: string;
  subtitle?: string;
  categories?: FAQCategory[];
  items?: FAQItem[];
  ctaText?: string;
  ctaHref?: string;
}

const {
  title,
  subtitle,
  categories,
  items,
  ctaText,
  ctaHref,
} = Astro.props;

// Flatten categories or use items directly
const allItems = categories
  ? categories.flatMap(cat => cat.items.map(item => ({ ...item, category: cat.name })))
  : items || [];
---

<section class="py-20 sm:py-28 bg-muted">
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <h2 class="text-3xl sm:text-4xl font-bold text-foreground">
        {title}
      </h2>
      {subtitle && (
        <p class="mt-4 text-lg text-muted-foreground">
          {subtitle}
        </p>
      )}
    </div>

    {categories ? (
      <div class="space-y-8">
        {categories.map((category) => (
          <div>
            <h3 class="text-lg font-semibold text-foreground mb-4">{category.name}</h3>
            <div class="space-y-3">
              {category.items.map((item, index) => (
                <details class="group bg-card border border-border rounded-lg" data-faq-item>
                  <summary class="flex items-center justify-between p-4 cursor-pointer list-none">
                    <span class="font-medium text-foreground pr-4">{item.question}</span>
                    <svg
                      class="w-5 h-5 text-muted-foreground shrink-0 transition-transform group-open:rotate-180"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </summary>
                  <div class="px-4 pb-4 text-muted-foreground">
                    {item.answer}
                  </div>
                </details>
              ))}
            </div>
          </div>
        ))}
      </div>
    ) : (
      <div class="space-y-3">
        {allItems.map((item) => (
          <details class="group bg-card border border-border rounded-lg" data-faq-item>
            <summary class="flex items-center justify-between p-4 cursor-pointer list-none">
              <span class="font-medium text-foreground pr-4">{item.question}</span>
              <svg
                class="w-5 h-5 text-muted-foreground shrink-0 transition-transform group-open:rotate-180"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="px-4 pb-4 text-muted-foreground">
              {item.answer}
            </div>
          </details>
        ))}
      </div>
    )}

    {ctaText && ctaHref && (
      <div class="mt-12 text-center p-6 bg-card border border-border rounded-lg">
        <p class="text-foreground mb-4">{ctaText}</p>
        <a
          href={ctaHref}
          class="inline-flex items-center gap-2 text-primary hover:underline font-medium"
        >
          Contact us
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>
    )}
  </div>
</section>
